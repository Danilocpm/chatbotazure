name: Keep Bot Alive

on:
  schedule:
    # Executa a cada 10 minutos (Azure F1 desliga ap√≥s 20 min de inatividade)
    - cron: '*/10 * * * *'
  workflow_dispatch: # Permite executar manualmente

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Health Endpoint
        env:
          BOT_URL: ${{ secrets.BOT_URL }}
        run: |
          # Verifica hor√°rio (UTC)
          hour=$(date -u +%H)
          # Bras√≠lia √© UTC-3, ent√£o 8h-18h BRT = 11h-21h UTC
          if [ $hour -lt 11 ] || [ $hour -ge 21 ]; then
            echo "‚è∞ Fora do hor√°rio de opera√ß√£o (8h-18h Bras√≠lia)"
            echo "Hor√°rio atual UTC: ${hour}:00"
            exit 0
          fi
          
          echo "üèì Fazendo ping no bot para evitar cold start..."
          echo "Hor√°rio atual UTC: ${hour}:00 (Bras√≠lia: ~$((hour-3)):00)"
          
          # Faz requisi√ß√£o ao endpoint de health
          response=$(curl -s -o /dev/null -w "%{http_code}" ${BOT_URL}/api/health || echo "failed")
          
          if [ "$response" = "200" ]; then
            echo "‚úÖ Bot est√° ativo! Status: $response"
          else
            echo "‚ö†Ô∏è Bot pode estar em cold start. Status: $response"
            echo "Tentando novamente em 10 segundos..."
            sleep 10
            curl -s ${BOT_URL}/api/health || echo "Segunda tentativa falhou"
          fi
          
          echo "Ping conclu√≠do √†s $(date)"
